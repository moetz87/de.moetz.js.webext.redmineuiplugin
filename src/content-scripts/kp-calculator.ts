import { Domready } from '../shared/utils/domready-dynamic';
import { HtmlUtils } from '../shared/utils/html-utils';

const CUSTOM_FIELD_KP = 'cf_10';
const KP_HEADER_SELECTOR = 'a:contains("Komplexitätspunkte")';
const KP_SELECTED = `tr.context-menu-selection > td.${CUSTOM_FIELD_KP}`;
const KP_SELECTED_DELAY = 50;
const ICON_SUM = 'data:image/png;base64,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';
const ICON_SELECTED = 'data:image/png;base64,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';

export class KPCalculator {

    public async main() {
        const kpSum = this.calculateKPs();
        if (kpSum) {
            this.showKPSums(kpSum, 0);
        }
        this.setOnTableRowChanged();
    }

    private calculateKPs(): number {
        const selector = `.${CUSTOM_FIELD_KP}`;
        const elements = HtmlUtils.find(selector);
        if (elements.length === 0) {
            return 0;
        }
        return elements.map(e => Number(e.textContent)).reduce((a, b) => a + b);
    }

    private calculateSelectedKPs(): number {
        const selector = KP_SELECTED;
        const elements = HtmlUtils.find(selector);
        if (elements.length === 0) {
            return 0;
        }
        return elements.map(e => Number(e.textContent)).reduce((a, b) => a + b);
    }

    private showKPSums(sum: number, selectedSum: number) {
        const header = HtmlUtils.findFirst<HTMLAnchorElement>(KP_HEADER_SELECTOR);
        const sumIcon = `<img src="${ICON_SUM}">`;
        const selectedIcon = `<img src="${ICON_SELECTED}">`;
        // tslint:disable-next-line:no-inner-html
        header.innerHTML = `Komplexitätspunkte<br>(${sumIcon} ${sum}, ${selectedIcon} ${selectedSum})`;
    }

    private setOnTableRowChanged() {
        HtmlUtils.findFirst<HTMLElement>('body').onclick = () => {
            this.onTableRowChanged();
        };
    }

    private onTableRowChanged() {
        setTimeout(() => {
            const kpSum = this.calculateKPs();
            const kpSelectedSum = this.calculateSelectedKPs();
            this.showKPSums(kpSum, kpSelectedSum);
        }, KP_SELECTED_DELAY);
    }

}

Domready.onReady(async () => new KPCalculator().main());
